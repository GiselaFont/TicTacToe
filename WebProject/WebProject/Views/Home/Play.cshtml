@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using WebProject.Models
@model TicTacToeViewModel

<div class="about">
    <h4>Play with us!</h4>
  
    <button id="toggle1">New Game</button>
    <br />
    <br />
    <div id="hidden1" style="display:none;">
        @foreach (var tables in Model.Table)
        {
            <table border="1" height="100" width="100">
                <tr>
                    <td id="cell11">@tables.cell11</td>
                    <td id="cell12">@tables.cell12</td>
                    <td id="cell13">@tables.cell13</td>
                </tr>
                <tr>
                    <td id="cell21">@tables.cell21</td>
                    <td id="cell22">@tables.cell22</td>
                    <td id="cell23">@tables.cell23</td>
                </tr>
                <tr>
                    <td id="cell31">@tables.cell31</td>
                    <td id="cell32">@tables.cell32</td>
                    <td id="cell33">@tables.cell33</td>
                </tr>
            </table>
        }
    </div> 
    <button id="save">Save</button>
    
    <div id="savedGames">
        @foreach (var tables in Model.Table)
        {
            if (tables.Id != 0)
            {
                <button id="@tables.Id">Game @tables.Id</button>
            }
        }
    </div>
</div>

@section Scripts {
    <script>

        $(document).ready(function () {

            var count = 0;
            var x = false;

            $('#toggle1').click(function () {
                $('#hidden1').show();
            });

            $('td').click(function () {
               
                if (!$(this).html()) {
                    if (x == false) {
                        $(this).html("X");
                        x = true;
                    }
                    else {
                        $(this).html("O");
                        x = false;
                    }

                    var cellValues = {
                        "cell11": $("#cell11").html(),
                        "cell12": $("#cell12").html(),
                        "cell13": $("#cell13").html(),
                        "cell21": $("#cell21").html(),
                        "cell22": $("#cell22").html(),
                        "cell23": $("#cell23").html(),
                        "cell31": $("#cell31").html(),
                        "cell32": $("#cell32").html(),
                        "cell33": $("#cell33").html()
                    };

                    //send values to controller to store in database
                    $.post('/Home/Play', { table: cellValues }, function (response) {
                    });

                    var end = CheckEndGame($(this).get(0).id.split(""), $(this).html());

                    if(end == true)
                    {
                        StartNewGame();
                    }
                }
            });

            function CheckEndGame(num, text)
            {
                count++;
                var i = num[num.length - 2];
                var j = num[num.length - 1];
                
                if ($("#cell" + i + "" + 1).html() == $("#cell" + i + "" + 2).html() && $("#cell" + i + "" + 2).html() == $("#cell" + i + "" + 3).html()) {
                    alert(text + " won!");
                    return true;
                }
                else if ($("#cell" + 1 + "" + j).html() == $("#cell" + 2 + "" + j).html() && $("#cell" + 2 + "" + j).html() == $("#cell" + 3 + "" + j).html()){
                    alert(text + " won!");
                    return true;
                }
                else if ((i == 2 && j == 2) || ((i == 1 && j == 3) || (i == 3 && j == 1))) {
                    if ($("#cell" + 1 + "" + 3).html() == $("#cell" + 2 + "" + 2).html() && $("#cell" + 2 + "" + 2).html() == $("#cell" + 3 + "" + 1).html()) {
                        alert(text + " won!");
                        return true;
                    }
                }
                else if (i == j) {
                    if ($("#cell" + 1 + "" + 1).html() == $("#cell" + 2 + "" + 2).html() && $("#cell" + 2 + "" + 2).html() == $("#cell" + 3 + "" + 3).html()) {
                        alert(text + " won!");
                        return true;
                    }
                }
                if (count == 9)
                {
                    alert("It's a tie!");
                    return true;
                }
                return false;

            }

            function StartNewGame() {
                $("#save").click(function () {
                    $('#hidden1').show();

                });
            }

        });

        
        
    </script>
}
